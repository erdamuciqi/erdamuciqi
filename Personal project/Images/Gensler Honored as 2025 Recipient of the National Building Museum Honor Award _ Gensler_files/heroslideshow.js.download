define(["jquery","modernizr","module/globals/tracking"],(function(t){"use strict";function i(i,n){if(this.options=i,this.container=n,this.index=0,this.id=this.container.attr("id"),this.mv=!1,this.tracking=s.tracking||!1,this.id||(this.id=this.container.data("id")),this.imgs=this.container.find("img,.hero-homepage-video,.hero-video,.hero-img").not(".no-hero-slideshow").not(this.container.find(".hero-img img")).not(this.container.find(".hero-video img")).not(this.container.find(".hero-homepage-video img")).fadeTo(0,0).stop(!0,!0).data("slideshow-trigger",!1),this.length=this.imgs.size(),r)for(var h in a)a.hasOwnProperty(h)&&this.imgs.filter("img").css(a[h],"translateZ(0)");this.imgs.eq(this.index).is(".hero-video")?this.container.addClass("slide-video"):this.container.removeClass("slide-video"),t(this.imgs.get().reverse()).each(t.proxy((function(i,e){var s=t(e),n={position:"absolute",zIndex:100+i,top:0,left:0,visibility:"visible"};if(s.hasClass("horizontal")?(n.top="50%",n.transform=r?"translate3d(0,-50%,0)":"translateY(-50%)"):s.hasClass("vertical")&&(n.left="50%",n.transform=r?"translate3d(-50%,0,0)":"translateX(-50%)"),n.transform)for(var i in a)a.hasOwnProperty(i)&&(n[a[i]]=n.transform);s.css(n)}),this)),document.addEventListener("lazyloaded",t.proxy(this.onLazyloaded,this),!0);var d=t([]);this.nav={prev:t('<div class="slideshow-prev"><i class="icon-angle-left"></i></div>'),next:t('<div class="slideshow-next"><i class="icon-angle-right"></i></div>'),caption:this.container.find(".caption"),overlay:this.container.find(".hero-caption-overlay"),overlayToggle:this.container.find(".toggle-caption"),index:d,dots:d,fullscreen:d,download:d};var l=t('[data-for="detail-hero-image"]');l.size()&&(this.nav.index=l.find(".slideshow-slide span"),this.nav.dots=l.find(".slideshow-paging"),this.nav.fullscreen=l.find(".slideshow").not(".download"),this.nav.download=l.find(".slideshow.download")),this.length>1&&(null!==this.options.arrowsContainer?t(this.options.arrowsContainer).first().append(this.nav.prev,this.nav.next):this.container.append(this.nav.prev,this.nav.next),this.nav.prev.off().on("click",t.proxy((function(t){t.preventDefault(),this.mv||(this.tracking&&this.tracking.trackEvent("Hero Arrow","left",s.location.pathname),this.prev())}),this)),this.nav.next.off().on("click",t.proxy((function(t){t.preventDefault(),this.mv||(this.tracking&&this.tracking.trackEvent("Hero Arrow","right",s.location.pathname),this.next())}),this)),this.nav.dots.off("click").on("click",".nav",t.proxy((function(i){i.preventDefault(),i.stopPropagation(),i.stopImmediatePropagation(),this.show(t(i.currentTarget).parent().find(".nav").index(i.currentTarget))}),this))),this.nav.fullscreen.attr("href","").off().on("click",t.proxy((function(t){if(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!this.nav.fullscreen.parent().hasClass("disabled")&&s.slideshow&&s.slideshow.length>0){for(var i=0;i<s.heroSlideshow.length;i++)s.heroSlideshow[i].pauseVideos(),o&&s.heroSlideshow[i].resetVideos();s.slideshow[0].open(this.index)}}),this)),this.length>1&&(o&&e.call(this),this.options.showArrows?(this.nav.prev.add(this.nav.next).stop(!0).fadeTo(i.animDuration,1),o?this.nav.prev.add(this.nav.next).find("i").stop(!0).fadeTo(i.animDuration,1):this.nav.prev.add(this.nav.next).on("mouseenter",(function(){t(this).find("i").stop(!0).fadeTo(i.animDuration,1)})).on("mouseleave",(function(){t(this).find("i").stop(!0).fadeTo(i.animDuration,.5)}))):this.nav.prev.add(this.nav.next).show().find("i").remove()),"IMG"!==this.imgs.eq(this.index).prop("tagName")&&this.show(this.index)}function e(i){i||(i=this.container);var e={x:0,y:0},s={},n=!1,o=!1;i.on("touchstart",t.proxy((function(t){if(n)return!0;var i=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0];e={x:i.pageX,y:i.pageY},this.mv=!1}),this)).on("touchmove",t.proxy((function(t){if(!n&&!o){var i=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0];if(!this.mv)if(i.pageX<e.x-10||i.pageX>e.x+10)this.mv=!0,this.imgs.find("iframe").css("pointer-events","none"),s.current=this.imgs.eq(this.index).css("z-index",1),s.prev=this.imgs.eq(this.index-1<0?this.imgs.size()-1:this.index-1).css("left",-s.current.width()+"px"),s.next=this.imgs.eq(this.index+1>this.imgs.size()-1?0:this.index+1).css("left",s.current.width()+"px"),s.same=s.prev.is(s.next),s.dir=1,s.all=s.current.add(s.prev).add(s.next),s.prev.add(s.next).css({position:"absolute",top:0,width:s.current.width()+"px",height:s.current.height()+"px",zIndex:0}).show().fadeTo(0,1);else if(i.pageY<e.y-5||i.pageY>e.y+5)return void(o=!0);if(this.mv){t.preventDefault();var h=i.pageX-e.x;for(var d in s.same&&(h>0?2!=s.dir&&(s.dir=2,s.prev.css("left",-s.current.width()+"px")):1!=s.dir&&(s.dir=1,s.next.css("left",s.current.width()+"px"))),a)a.hasOwnProperty(d)&&s.all.css(a[d],r?"translate3d("+h+"px,0,0)":"translate("+h+"px,0)")}}}),this)).on("touchend touchcancel",t.proxy((function(i){if(o=!1,this.imgs.find("iframe").css("pointer-events","auto"),n||!this.mv)return!0;var h=(i.originalEvent.touches[0]||i.originalEvent.changedTouches[0]).pageX-e.x,d=Math.abs(h),l=s.current.width(),c=s.current,p=0,f=1.5*this.options.animDuration*d/l;Math.abs(h)>=l/3&&(c=h>0?s.prev:s.next,p=h>0?l:-l,f=1.5*this.options.animDuration*(l-d)/l),n=!0,t({a:h}).animate({a:p},{duration:f,step:function(t){for(var i in a)a.hasOwnProperty(i)&&s.all.css(a[i],r?"translate3d("+t+"px,0,0)":"translate("+t+"px,0)")},complete:t.proxy((function(){for(var i in s.all.not(c.css("display","block")).hide(),a)a.hasOwnProperty(i)&&s.all.css(a[i],r?"translateZ(0)":"");s.all.css({position:"",width:"",height:"",zIndex:"",left:""}),this.index=this.imgs.index(c),this.show(this.index),setTimeout(t.proxy((function(){this.mv=!1,n=!1}),this),0)}),this)})}),this))}var s=window,n=t(window),o=s.Modernizr?s.Modernizr.touchevents:"ontouchstart"in s,a={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"},r=function(){var t,i=document.createElement("p"),e={};for(var n in document.body.insertBefore(i,null),a)void 0!==i.style[n]&&(e[n]=a[n],i.style[n]="translate3d(1px,1px,1px)",t=s.getComputedStyle(i).getPropertyValue(a[n]));return document.body.removeChild(i),a=e,void 0!==t&&t.length>0&&"none"!==t}(),h={animDuration:250,animEffect:"crossfade",showArrows:!0,arrowsContainer:null,onShow:null},d=function(t){return decodeURIComponent((t+"").replace(/%(?![\da-f]{2})/gi,(function(){return"%25"})))};return s.heroSlideshow=[],i.prototype.onLazyloaded=function(t){var i=t.target;document.dispatchEvent(new CustomEvent("removeLazySpinner",{target:i}));var e=this.imgs.filter(i);e.length&&this.imgs.eq(this.index).is(e)&&this.show(this.index)},i.prototype.show=function(i){if(i!=this.index){var e=this.imgs.eq(this.index),a=this.imgs.eq(i);if(!e.size()||!a.size())return;e.css({"z-index":101+this.length}),a.css({"z-index":102+this.length}),"crossfade"==this.options.animEffect?(e.fadeTo(0,1).stop(!0,!0).fadeTo(this.options.animDuration,0),a.fadeTo(0,0).stop(!0,!0).fadeTo(this.options.animDuration,1,(function(){e.hide()}))):"dissolve"==this.options.animEffect?(s.slideI1=e,s.slideI2=a,e.stop(!0,!0).fadeTo(0,1),a.stop(!0,!0).fadeTo(0,0).fadeTo(this.options.animDuration,1,(function(){e.hide()}))):(e.stop(!0,!0).fadeTo(0,0).hide(),a.stop(!0,!0).fadeTo(0,1).show(),a.css({position:"",display:"block",left:"",top:""})),this.index=i,this.pauseVideos(),this.autoplayVideo(),o&&this.resetVideos()}else"crossfade"==this.options.animEffect||"dissolve"==this.options.animEffect?this.imgs.eq(i).fadeTo(0,0).stop(!0,!0).fadeTo(this.options.animDuration,1):this.imgs.eq(i).stop(!0,!0).fadeTo(0,1).show();for(var r=0;r<s.heroSlideshow.length;r++)s.heroSlideshow[r].id==this.id&&s.heroSlideshow[r].index!=this.index&&s.heroSlideshow[r].show(this.index);this.nav.index.text(this.index+1),this.nav.dots.each(t.proxy((function(i,e){t(e).find(".nav").removeClass("active").eq(this.index).addClass("active")}),this));var h=this.imgs.eq(this.index);h.is(".hero-video")?this.container.addClass("slide-video"):this.container.removeClass("slide-video"),this.nav.download.attr("href",h.attr("data-slideshow")||h.attr("src"));var l,c=!1;if(this.nav.caption.removeData("settings"),""!==h.attr("data-settings"))try{c=JSON.parse(d(h.attr("data-settings"))),this.nav.caption.removeClass("left").removeClass("right").addClass(c.pos?c.pos:""),this.nav.caption.data("settings",c)}catch(t){}if(""!==h.attr("data-url"))if((l=t(document.createElement("a"))).html(t(document.createElement("span")).append(h.attr("data-caption"))),l.attr("href",h.attr("data-url")),l.attr("target",h.attr("data-target")),this.nav.caption.html(l),h.attr("data-overlay")){var p=d(h.attr("data-overlay"));p&&(this.nav.overlay.html(p),this.nav.overlay.show(),this.nav.overlayToggle.css("visibility","visible"))}else this.nav.overlay.hide(),this.nav.overlayToggle.css("visibility","hidden");else l=t('<span class="homepage-caption"></span>'),""!==h.attr("data-caption")?this.nav.caption.html(l.append(t(document.createElement("span")).append(h.attr("data-caption")))):this.nav.caption.html("");c&&l.size()&&c.class&&l.addClass(c.class),"1"===h.attr("data-fs-disabled")?this.nav.fullscreen.parent().addClass("disabled"):this.nav.fullscreen.parent().removeClass("disabled"),this.options.onShow&&t.isFunction(this.options.onShow)&&this.options.onShow.call(this),n.trigger("heroSlideshowChange",[this])},i.prototype.prev=function(){var t=this.index-1;this.imgs&&this.imgs.length&&(t<0&&(t=this.imgs.size()-1),this.show(t))},i.prototype.next=function(){var t=this.index+1;this.imgs&&this.imgs.length&&(t>this.imgs.size()-1&&(t=0),this.show(t))},i.prototype.autoplayVideo=function(){var t=this.imgs.eq(this.index);t.data("autoplay")&&(t.find("iframe").each((function(){this.contentWindow.postMessage('{"event":"command","func":"playVideo"}',"*"),this.contentWindow.postMessage('{"method":"play"}',"*")})),t.find("video").each((function(){this.play()})))},i.prototype.pauseVideos=function(){var t=this.imgs.eq(this.index).find("iframe, video");this.container.find("iframe").not(t).each((function(){this.contentWindow.postMessage('{"event":"command","func":"pauseVideo"}',"*"),this.contentWindow.postMessage('{"method":"pause"}',"*")})),this.container.find("video").not(t).each((function(){this.pause()}))},i.prototype.resetVideos=function(){this.container.find("iframe").each((function(){var i=t(this).parent().html();t(this).parent().html(i)}))},t.fn.heroSlideshow=function(e){return t(this).each((function(){if(!t(this).data("heroSlideshow")&&t(this).find("img,.hero-homepage-video,.hero-video,.hero-img").size()>0){var n=new i(t.extend(h,e),t(this));s.heroSlideshow.push(n),t(this).data("heroSlideshow",n),n.show(0)}})),document.dispatchEvent(new CustomEvent("heroSlideshowReady")),this},{start:function(){t("div.hero-slideshow").heroSlideshow()}}}));